-- ==================== é˜²å¤šå¼€æ£€æŸ¥ ====================
local function AntiMultiOpen()
    local existingGui = game:GetService("CoreGui"):FindFirstChild("KJY_Team_AntiDup")
    if existingGui then
        game:GetService("Players").LocalPlayer:Kick("Script already running! Please wait.")
        return false
    end
    
    local antiDupGui = Instance.new("ScreenGui")
    antiDupGui.Name = "KJY_Team_AntiDup"
    antiDupGui.Parent = game:GetService("CoreGui")
    
    game:GetService("Players").PlayerRemoving:Connect(function(player)
        if player == game:GetService("Players").LocalPlayer then
            antiDupGui:Destroy()
        end
    end)
    
    return true
end

if not AntiMultiOpen() then
    return
end

-- ==================== ç™½åå•éªŒè¯ ====================
local player = game:GetService("Players").LocalPlayer
local function checkWhitelist()
    local playerName = player.Name
    local success, isWhitelisted = pcall(function()
        local list = game:HttpGet("https://raw.githubusercontent.com/qiaoxxyxx/Roblox/refs/heads/main/whitelist.txt")
        local whitelist = {}
        for name in list:gmatch("[^,]+") do whitelist[name:gsub("%s+","")] = true end
        return whitelist[playerName]
    end)
    
    if not success or not isWhitelisted then
        player:Kick("æœªæˆæƒç”¨æˆ·")
        return false
    end
    return true
end

if not checkWhitelist() then return end

-- ==================== é˜²æŒ‚æœº ====================
player.Idled:Connect(function()
    game:GetService("VirtualUser"):Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    wait(1)
    game:GetService("VirtualUser"):Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- ==================== ä»GitHubåŠ è½½WindUIæ¡†æ¶ ====================
local success, winduiCode = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/qiaoxxyxx/Roblox/refs/heads/main/windui.lua")
end)

if success and winduiCode then
    local winduiFunc, errorMsg = loadstring(winduiCode)
    if winduiFunc then
        pcall(winduiFunc)
        print("âœ… WindUIæ¡†æ¶åŠ è½½å®Œæˆ")
        
        -- ç­‰å¾…WindUIæ¡†æ¶åˆå§‹åŒ–
        wait(0.5)
        
        -- ==================== åŠŸèƒ½çŠ¶æ€å˜é‡ ====================
        local functionStates = {}
        
        -- 1. æ ¼å¼åŒ–å‡½æ•°
        local function formatNumber(value)
            if value < 1000 then return string.format("%.0f", value) end
            local suffixes = {"K", "M", "B", "T", "Qa", "Qi"}
            local order = math.floor(math.log(value) / math.log(1000))
            local scaled = value / (1000 ^ order)
            return string.format("%.2f%s", scaled, suffixes[order] or "")
        end
        
        -- 2. æé€Ÿé”»ç‚¼åŠŸèƒ½
        functionStates.spamTraining = false
        local batchSize = 20
        
        local function spamExerciseEvents()
            while functionStates.spamTraining do
                pcall(function()
                    local muscleEvent = player.muscleEvent
                    for i = 0, batchSize do
                        muscleEvent:FireServer("rep")
                    end
                end)
                task.wait(0.01)
            end
        end
        
        -- 3. è‡ªåŠ¨è›‹ç™½è›‹åŠŸèƒ½
        functionStates.autoProtein = false
        
        local function proteinLoop()
            while functionStates.autoProtein do
                pcall(function()
                    if not player.boostTimersFolder:FindFirstChild("Protein Egg") then
                        local egg = player.Backpack:FindFirstChild("Protein Egg")
                        if egg then
                            player.Character.Humanoid:EquipTool(egg)
                            task.wait(0.1)
                            if player.Character:FindFirstChild("Protein Egg") then
                                player.muscleEvent:FireServer("proteinEgg", player.Character:FindFirstChild("Protein Egg"))
                                player.Character.Humanoid:UnequipTools()
                            end
                        end
                    end
                end)
                task.wait(0.2)
            end
        end
        
        -- 4. è‡ªåŠ¨å¥¶æ˜”åŠŸèƒ½
        functionStates.autoShake = false
        
        local function shakeLoop()
            while functionStates.autoShake do
                pcall(function()
                    local shake = player.Backpack:FindFirstChild("Tropical Shake")
                    if shake then
                        player.Character.Humanoid:EquipTool(shake)
                        task.wait(0.05)
                        if player.Character:FindFirstChild("Tropical Shake") then
                            player.muscleEvent:FireServer("tropicalShake", player.Character:FindFirstChild("Tropical Shake"))
                            player.Character.Humanoid:UnequipTools()
                        end
                    end
                end)
                task.wait(0.1)
            end
        end
        
        -- 5. æ¸…é™¤UIåŠŸèƒ½
        local function cleanUI()
            local keywords = {"+","Coins","Coin","Strength","Exp","Experience","Level","Damage","Health"}
            local protected = {"MobileWindUI","Crazy Top","Rayfield", "KJY_Team_AntiDup"}
            
            local function cleanGui(parent)
                for _, gui in ipairs(parent:GetChildren()) do
                    if gui:IsA("ScreenGui") then
                        local shouldRemove = true
                        for _, name in ipairs(protected) do
                            if gui.Name:find(name) then
                                shouldRemove = false
                                break
                            end
                        end
                        
                        if shouldRemove then
                            for _, element in ipairs(gui:GetDescendants()) do
                                if (element:IsA("TextLabel") or element:IsA("TextButton")) and element.Text then
                                    for _, keyword in ipairs(keywords) do
                                        if element.Text:find(keyword) then
                                            gui:Destroy()
                                            break
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
            
            cleanGui(game:GetService("CoreGui"))
            cleanGui(player:FindFirstChild("PlayerGui"))
        end
        
        -- ==================== æ·»åŠ æŒ‰é’®åˆ°WindUI ====================
        if _G.WindUI and _G.WindUI.AddButton then
            -- æé€Ÿé”»ç‚¼æŒ‰é’®
            _G.WindUI.AddButton("âš¡ æé€Ÿé”»ç‚¼", "20å€é€Ÿåº¦å¿«é€Ÿé”»ç‚¼", function()
                functionStates.spamTraining = not functionStates.spamTraining
                print("æé€Ÿé”»ç‚¼: " .. (functionStates.spamTraining and "å¼€å¯" or "å…³é—­"))
                if functionStates.spamTraining then
                    task.spawn(spamExerciseEvents)
                end
            end)
            
            -- è‡ªåŠ¨è›‹ç™½è›‹æŒ‰é’®
            _G.WindUI.AddButton("ğŸ¥š è‡ªåŠ¨è›‹ç™½è›‹", "è‡ªåŠ¨ä½¿ç”¨è›‹ç™½è›‹å¢ç›Š", function()
                functionStates.autoProtein = not functionStates.autoProtein
                print("è‡ªåŠ¨è›‹ç™½è›‹: " .. (functionStates.autoProtein and "å¼€å¯" or "å…³é—­"))
                if functionStates.autoProtein then
                    task.spawn(proteinLoop)
                end
            end)
            
            -- è‡ªåŠ¨å¥¶æ˜”æŒ‰é’®
            _G.WindUI.AddButton("ğŸ¹ è‡ªåŠ¨å¥¶æ˜”", "è‡ªåŠ¨ä½¿ç”¨çƒ­å¸¦å¥¶æ˜”", function()
                functionStates.autoShake = not functionStates.autoShake
                print("è‡ªåŠ¨å¥¶æ˜”: " .. (functionStates.autoShake and "å¼€å¯" or "å…³é—­"))
                if functionStates.autoShake then
                    task.spawn(shakeLoop)
                end
            end)
            
            -- æ¸…é™¤UIæŒ‰é’®
            _G.WindUI.AddButton("ğŸ§¹ æ¸…é™¤UI", "æ¸…ç†å±å¹•å¢ç›Šæç¤º", function()
                print("æ¸…é™¤UIä¸­...")
                cleanUI()
                print("UIæ¸…ç†å®Œæˆ")
            end)
        else
            warn("âŒ WindUI APIæœªæ‰¾åˆ°")
        end
        
        -- ==================== ç»Ÿè®¡æ•°æ®æ›´æ–° ====================
        local strengthSamples = {}
        local sampleInterval = 1
        local sampleDuration = 20
        local lastStrength = 0
        
        spawn(function()
            while wait(sampleInterval) do
                pcall(function()
                    local currentStrength = player.leaderstats.Strength.Value
                    
                    -- æ›´æ–°æ ‡é¢˜æ åŠ›é‡æ˜¾ç¤º
                    if _G.WindUI and _G.WindUI.UpdateTitle then
                        _G.WindUI.UpdateTitle("strength " .. formatNumber(currentStrength))
                    end
                    
                    -- æ›´æ–°æ•°æ®æ ‡ç­¾
                    if lastStrength > 0 then
                        local gain = currentStrength - lastStrength
                        local currentSpeed = gain / sampleInterval
                        local currentTime = tick()
                        
                        table.insert(strengthSamples, {
                            time = currentTime,
                            strength = currentStrength
                        })
                        
                        while #strengthSamples > 0 and (currentTime - strengthSamples[1].time) > sampleDuration do
                            table.remove(strengthSamples, 1)
                        end
                        
                        local avgSpeed20s = 0
                        if #strengthSamples >= 2 then
                            local first = strengthSamples[1]
                            local last = strengthSamples[#strengthSamples]
                            local timeDiff = last.time - first.time
                            if timeDiff > 0 then
                                avgSpeed20s = (last.strength - first.strength) / timeDiff
                            end
                        end
                        
                        -- è®¡ç®—æ¯æ—¥/æ¯æœˆé¢„è®¡æ”¶ç›Š
                        local dailyGain, monthlyGain = 0, 0
                        if avgSpeed20s > 0 then
                            local secondsPerDay = 24 * 60 * 60
                            local secondsPerMonth = 30 * secondsPerDay
                            dailyGain = avgSpeed20s * secondsPerDay
                            monthlyGain = avgSpeed20s * secondsPerMonth
                        end
                        
                        -- æ›´æ–°è›‹ç™½è›‹çŠ¶æ€
                        local hasProtein = false
                        if player.boostTimersFolder then
                            hasProtein = player.boostTimersFolder:FindFirstChild("Protein Egg") ~= nil
                        end
                        
                        if _G.WindUI and _G.WindUI.UpdateStats then
                            _G.WindUI.UpdateStats({
                                current_strength = formatNumber(currentStrength),
                                current_speed = string.format("%.1f/s", currentSpeed),
                                avg_speed_20s = string.format("%.1f/s", avgSpeed20s),
                                daily_gain = formatNumber(dailyGain),
                                monthly_gain = formatNumber(monthlyGain),
                                protein_status = hasProtein and "on" or "off"
                            })
                        end
                    else
                        if _G.WindUI and _G.WindUI.UpdateStats then
                            _G.WindUI.UpdateStats({
                                current_strength = formatNumber(currentStrength),
                                current_speed = "0/s",
                                avg_speed_20s = "0/s",
                                daily_gain = "0",
                                monthly_gain = "0",
                                protein_status = "off"
                            })
                        end
                    end
                    
                    lastStrength = currentStrength
                end)
            end
        end)
        
        print("âœ… Cr4zy Strength Pro åŠ è½½å®Œæˆï¼")
        
    else
        warn("âŒ WindUIä»£ç åŠ è½½å¤±è´¥: " .. tostring(errorMsg))
        player:Kick("WindUIåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")
    end
else
    warn("âŒ æ— æ³•ä»GitHubåŠ è½½WindUIä»£ç ")
    player:Kick("æ— æ³•åŠ è½½ç•Œé¢æ–‡ä»¶")
end
