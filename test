-- ==================== 防多开检查 ====================
if game:GetService("CoreGui"):FindFirstChild("KJY_Team_AntiDup") then
    game:GetService("Players").LocalPlayer:Kick("Script already running!")
    return
end
Instance.new("ScreenGui", game:GetService("CoreGui")).Name = "KJY_Team_AntiDup"

-- ==================== WindUI库 ====================
local WindUI = (function()
    local playerGui = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    for _, gui in ipairs(playerGui:GetChildren()) do
        if gui:IsA("ScreenGui") and gui.Name == "WindUI" then gui:Destroy() end
    end

    local player = game:GetService("Players").LocalPlayer
    local screenSize = workspace.CurrentCamera.ViewportSize
    local windowWidth = math.min(160, screenSize.X * 0.35)

    -- 创建GUI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WindUI"
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- 欢迎文字
    local welcomeFrame = Instance.new("Frame", screenGui)
    welcomeFrame.Size = UDim2.new(0, math.min(250, screenSize.X * 0.6), 0, 35)
    welcomeFrame.Position = UDim2.new(1, -math.min(250, screenSize.X * 0.6) - 10, 0, 10)
    welcomeFrame.BackgroundTransparency = 1
    welcomeFrame.ZIndex = 5

    local welcomeText = Instance.new("TextLabel", welcomeFrame)
    welcomeText.Size = UDim2.new(1, 0, 1, 0)
    welcomeText.BackgroundTransparency = 1
    welcomeText.Text = "Welcome " .. player.Name
    welcomeText.TextColor3 = Color3.fromRGB(255, 255, 255)
    welcomeText.TextSize = 16
    welcomeText.Font = Enum.Font.GothamBold
    welcomeText.TextXAlignment = Enum.TextXAlignment.Right

    -- Strength窗口
    local window = Instance.new("Frame", screenGui)
    window.Size = UDim2.new(0, windowWidth, 0, 200)
    window.Position = UDim2.new(0, 10, 0, 50)
    window.BackgroundColor3 = Color3.fromRGB(30, 20, 40)
    window.BackgroundTransparency = 0.2

    local titleBar = Instance.new("TextButton", window)
    titleBar.Size = UDim2.new(1, 0, 0, 25)
    titleBar.BackgroundColor3 = Color3.fromRGB(40, 25, 55)
    titleBar.Text = ""
    titleBar.AutoButtonColor = false

    local titleLabel = Instance.new("TextLabel", titleBar)
    titleLabel.Size = UDim2.new(1, -40, 1, 0)
    titleLabel.Position = UDim2.new(0, 8, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Strength"
    titleLabel.TextColor3 = Color3.fromRGB(255, 200, 255)
    titleLabel.TextSize = 12
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local contentFrame = Instance.new("ScrollingFrame", window)
    contentFrame.Size = UDim2.new(1, -6, 1, -31)
    contentFrame.Position = UDim2.new(0, 3, 0, 28)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 3
    contentFrame.ScrollBarImageColor3 = Color3.fromRGB(180, 120, 255)

    -- API
    local WindUI = {}
    local functionStates = {}
    local featuresCount = 0

    function WindUI.AddFunction(categoryName, functionName, callback)
        if categoryName ~= "Strength" then return false end
        
        local button = Instance.new("TextButton")
        button.Name = functionName
        button.Size = UDim2.new(1, -4, 0, 26)
        button.Position = UDim2.new(0, 2, 0, 5 + (featuresCount * 30))
        button.BackgroundColor3 = Color3.fromRGB(40, 25, 60)
        button.Text = functionName
        button.TextColor3 = Color3.fromRGB(220, 180, 255)
        button.TextSize = 12
        button.Font = Enum.Font.Gotham
        button.Parent = contentFrame
        
        functionStates[functionName] = false
        
        button.MouseButton1Click:Connect(function()
            functionStates[functionName] = not functionStates[functionName]
            button.BackgroundColor3 = functionStates[functionName] and Color3.fromRGB(255, 150, 200) or Color3.fromRGB(40, 25, 60)
            button.TextColor3 = functionStates[functionName] and Color3.fromRGB(255, 240, 245) or Color3.fromRGB(220, 180, 255)
            
            if callback then callback(functionStates[functionName]) end
        end)
        
        featuresCount = featuresCount + 1
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, 10 + (featuresCount * 30))
        return true
    end

    return WindUI
end)()

-- ==================== 基础设置 ====================
local e = game:GetService("Players").LocalPlayer
e.Idled:Connect(function()
    game:GetService("VirtualUser"):Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    wait(1)
    game:GetService("VirtualUser"):Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- ==================== 白名单验证 ====================
local function checkWhitelist()
    local playerName = game.Players.LocalPlayer.Name
    local success, isWhitelisted = pcall(function()
        local list = game:HttpGet("https://raw.githubusercontent.com/qiaoxxyxx/Roblox/refs/heads/main/whitelist.txt")
        local whitelist = {}
        for name in list:gmatch("[^,]+") do whitelist[name:gsub("%s+","")] = true end
        return whitelist[playerName]
    end)
    
    if not success or not isWhitelisted then
        game.Players.LocalPlayer:Kick("未授权用户")
        return false
    end
    return true
end

if not checkWhitelist() then return end

-- ==================== 添加功能 ====================
local spamTraining = false

-- 极速锻炼
WindUI.AddFunction("Strength", "极速锻炼", function(state)
    spamTraining = state
    if state then
        task.spawn(function()
            while spamTraining do
                pcall(function()
                    for i = 0, 20 do
                        e.muscleEvent:FireServer("rep")
                    end
                end)
                task.wait(0.01)
            end
        end)
    end
end)

-- 自动蛋白蛋
WindUI.AddFunction("Strength", "自动蛋白蛋", function(state)
    _G.AutoProtein = state
    if state then
        task.spawn(function()
            while _G.AutoProtein do
                pcall(function()
                    if not e.boostTimersFolder:FindFirstChild("Protein Egg") then
                        local egg = e.Backpack:FindFirstChild("Protein Egg")
                        if egg then
                            e.Character.Humanoid:EquipTool(egg)
                            wait(0.1)
                            if e.Character:FindFirstChild("Protein Egg") then
                                e.muscleEvent:FireServer("proteinEgg", e.Character:FindFirstChild("Protein Egg"))
                                e.Character.Humanoid:UnequipTools()
                            end
                        end
                    end
                end)
                wait(0.2)
            end
        end)
    end
end)

-- 清除增益UI
WindUI.AddFunction("Strength", "清除增益UI", function()
    local keywords = {"+","Coins","Coin","Strength","Exp","Experience","Level","Damage","Health"}
    local protected = {"WindUI","Crazy Top","Rayfield"}
    
    local function cleanGui(parent)
        for _, gui in ipairs(parent:GetChildren()) do
            if gui:IsA("ScreenGui") then
                local shouldRemove = true
                for _, name in ipairs(protected) do
                    if gui.Name:find(name) then
                        shouldRemove = false
                        break
                    end
                end
                
                if shouldRemove then
                    for _, element in ipairs(gui:GetDescendants()) do
                        if (element:IsA("TextLabel") or element:IsA("TextButton")) and element.Text then
                            for _, keyword in ipairs(keywords) do
                                if element.Text:find(keyword) then
                                    gui:Destroy()
                                    break
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    cleanGui(game:GetService("CoreGui"))
    cleanGui(e:FindFirstChild("PlayerGui"))
end)

-- 自动热带奶昔
WindUI.AddFunction("Strength", "自动热带奶昔", function(state)
    _G.AutoShake = state
    if state then
        task.spawn(function()
            while _G.AutoShake do
                pcall(function()
                    local shake = e.Backpack:FindFirstChild("Tropical Shake")
                    if shake then
                        e.Character.Humanoid:EquipTool(shake)
                        wait(0.05)
                        if e.Character:FindFirstChild("Tropical Shake") then
                            e.muscleEvent:FireServer("tropicalShake", e.Character:FindFirstChild("Tropical Shake"))
                            e.Character.Humanoid:UnequipTools()
                        end
                    end
                end)
                wait(0.1)
            end
        end)
    end
end)

print("脚本加载完成！所有功能可用。")
