local WindUI = (function()
    -- 移除所有现有的UI
    local playerGui = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    for _, gui in ipairs(playerGui:GetChildren()) do
        if gui:IsA("ScreenGui") and gui.Name == "WindUI" then
            gui:Destroy()
        end
    end

    -- 初始化
    local Players = game:GetService("Players")
    local UserInputService = game:GetService("UserInputService")
    local TweenService = game:GetService("TweenService")
    local RunService = game:GetService("RunService")

    local player = Players.LocalPlayer
    local username = player.Name
    local screenSize = workspace.CurrentCamera.ViewportSize

    -- 修改这里：创建Strength分类
    local categories = {{name = "Strength", color = Color3.fromRGB(255, 80, 80), features = {}}}

    -- 窗口参数
    local windowWidth = math.min(160, screenSize.X * 0.35)
    local windowHeight = 200
    local startX, startY = 10, 50
    categories[1].position = Vector2.new(startX, startY)

    -- 创建GUI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WindUI"
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- 背景
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(15, 10, 25)
    background.BackgroundTransparency = 0.8
    background.ZIndex = -10
    background.Parent = screenGui

    local starGradient = Instance.new("UIGradient")
    starGradient.Rotation = 90
    starGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 15, 35)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(20, 10, 30)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 5, 25))
    })
    starGradient.Parent = background

    -- 粉白渐变闪烁欢迎文字
    local welcomeFrame = Instance.new("Frame")
    welcomeFrame.Size = UDim2.new(0, math.min(250, screenSize.X * 0.6), 0, 35)
    welcomeFrame.Position = UDim2.new(1, -math.min(250, screenSize.X * 0.6) - 10, 0, 10)
    welcomeFrame.BackgroundTransparency = 1
    welcomeFrame.ZIndex = 5
    welcomeFrame.Parent = screenGui

    local welcomeText = Instance.new("TextLabel")
    welcomeText.Size = UDim2.new(1, 0, 1, 0)
    welcomeText.BackgroundTransparency = 1
    welcomeText.Text = "Welcome " .. username
    welcomeText.TextColor3 = Color3.fromRGB(255, 255, 255)
    welcomeText.TextSize = 16
    welcomeText.Font = Enum.Font.GothamBold
    welcomeText.TextXAlignment = Enum.TextXAlignment.Right
    welcomeText.ZIndex = 5
    welcomeText.Parent = welcomeFrame

    -- 粉白渐变效果
    local textGradient = Instance.new("UIGradient")
    textGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 240, 245)), -- 浅粉色
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(255, 220, 230)), -- 粉色
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(255, 200, 220)), -- 亮粉色
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 180, 210))  -- 深粉色
    })
    textGradient.Rotation = 90
    textGradient.Parent = welcomeText

    -- 文字描边
    local textStroke = Instance.new("UIStroke")
    textStroke.Color = Color3.fromRGB(255, 150, 200)
    textStroke.Thickness = 2
    textStroke.Transparency = 0.3
    textStroke.Parent = welcomeText

    -- 闪烁动画
    spawn(function()
        while welcomeText and welcomeText.Parent do
            -- 淡入
            local tweenIn = TweenService:Create(welcomeText, TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                TextTransparency = 0.2
            })
            tweenIn:Play()
            tweenIn.Completed:Wait()
            
            -- 淡出
            local tweenOut = TweenService:Create(welcomeText, TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                TextTransparency = 0.5
            })
            tweenOut:Play()
            tweenOut.Completed:Wait()
            
            -- 渐变颜色变化
            local currentColors = {
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 240, 245)),
                ColorSequenceKeypoint.new(0.3, Color3.fromRGB(255, 220, 230)),
                ColorSequenceKeypoint.new(0.6, Color3.fromRGB(255, 200, 220)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 180, 210))
            }
            
            -- 轻微调整渐变颜色
            local newColors = {
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 250, 255)), -- 更白
                ColorSequenceKeypoint.new(0.3, Color3.fromRGB(255, 230, 240)),
                ColorSequenceKeypoint.new(0.6, Color3.fromRGB(255, 210, 230)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 190, 220))
            }
            
            textGradient.Color = ColorSequence.new(newColors)
            wait(0.5)
            textGradient.Color = ColorSequence.new(currentColors)
        end
    end)

    -- 窗口创建
    local windows = {}
    local minimizedWindows = {}
    local functionStates = {}

    for i, category in ipairs(categories) do
        local window = Instance.new("Frame")
        window.Size = UDim2.new(0, windowWidth, 0, windowHeight)
        window.Position = UDim2.new(0, category.position.X, 0, category.position.Y)
        window.BackgroundColor3 = Color3.fromRGB(30, 20, 40)
        window.BackgroundTransparency = 0.2
        window.ZIndex = 1
        window.Parent = screenGui
        
        local border = Instance.new("Frame")
        border.Size = UDim2.new(1, 3, 1, 3)
        border.Position = UDim2.new(0, -1.5, 0, -1.5)
        border.BackgroundColor3 = Color3.fromRGB(120, 80, 180)
        border.ZIndex = 0
        border.Parent = window
        
        local innerBorder = Instance.new("Frame")
        innerBorder.Size = UDim2.new(1, -3, 1, -3)
        innerBorder.Position = UDim2.new(0, 1.5, 0, 1.5)
        innerBorder.BackgroundColor3 = Color3.fromRGB(25, 15, 35)
        innerBorder.BackgroundTransparency = 0.3
        innerBorder.Parent = border
        
        local titleBar = Instance.new("TextButton")
        titleBar.Size = UDim2.new(1, 0, 0, 25)
        titleBar.BackgroundColor3 = Color3.fromRGB(40, 25, 55)
        titleBar.Text = ""
        titleBar.AutoButtonColor = false
        titleBar.ZIndex = 2
        titleBar.Parent = innerBorder
        
        local titleLabel = Instance.new("TextLabel")
        titleLabel.Size = UDim2.new(1, -40, 1, 0)
        titleLabel.Position = UDim2.new(0, 8, 0, 0)
        titleLabel.BackgroundTransparency = 1
        titleLabel.Text = category.name
        titleLabel.TextColor3 = Color3.fromRGB(255, 200, 255)
        titleLabel.TextSize = 12
        titleLabel.Font = Enum.Font.GothamBold
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        titleLabel.ZIndex = 2
        titleLabel.Parent = titleBar
        
        local minimizeButton = Instance.new("TextButton")
        minimizeButton.Size = UDim2.new(0, 20, 0, 20)
        minimizeButton.Position = UDim2.new(1, -22, 0.5, -10)
        minimizeButton.AnchorPoint = Vector2.new(0.5, 0.5)
        minimizeButton.BackgroundColor3 = Color3.fromRGB(60, 40, 90)
        minimizeButton.Text = "─"
        minimizeButton.TextColor3 = Color3.fromRGB(220, 180, 255)
        minimizeButton.TextSize = 16
        minimizeButton.Font = Enum.Font.GothamBold
        minimizeButton.AutoButtonColor = false
        minimizeButton.ZIndex = 2
        minimizeButton.Parent = titleBar
        
        local contentFrame = Instance.new("ScrollingFrame")
        contentFrame.Size = UDim2.new(1, -6, 1, -31)
        contentFrame.Position = UDim2.new(0, 3, 0, 28)
        contentFrame.BackgroundTransparency = 1
        contentFrame.ScrollBarThickness = 3
        contentFrame.ScrollBarImageColor3 = Color3.fromRGB(180, 120, 255)
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        contentFrame.ZIndex = 2
        contentFrame.Parent = innerBorder
        
        local windowInfo = {
            frame = window,
            originalSize = UDim2.new(0, windowWidth, 0, windowHeight),
            originalPosition = UDim2.new(0, category.position.X, 0, category.position.Y),
            minimized = false,
            contentFrame = contentFrame,
            categoryName = category.name,
            featuresCount = 0
        }
        
        -- 拖动功能
        local isDragging = false
        local dragStart, windowStart = Vector2.new(0, 0), Vector2.new(0, 0)
        
        titleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                isDragging = true
                dragStart = input.Position
                windowStart = Vector2.new(window.Position.X.Offset, window.Position.Y.Offset)
                window.ZIndex = 10
                border.ZIndex = 9
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                window.Position = UDim2.new(0, windowStart.X + delta.X, 0, windowStart.Y + delta.Y)
            end
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if isDragging and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
                isDragging = false
                window.ZIndex = 1
                border.ZIndex = 0
                
                local currentPos = window.Position
                local newX = math.max(5, math.min(currentPos.X.Offset, screenSize.X - windowWidth - 5))
                local newY = math.max(10, math.min(currentPos.Y.Offset, screenSize.Y - windowHeight - 10))
                
                window.Position = UDim2.new(0, newX, 0, newY)
                windowInfo.originalPosition = window.Position
            end
        end)
        
        -- 收纳功能
        minimizeButton.MouseButton1Click:Connect(function()
            windowInfo.minimized = not windowInfo.minimized
            
            if windowInfo.minimized then
                window.Size = UDim2.new(0, windowWidth, 0, 25)
                contentFrame.Visible = false
                minimizeButton.Text = "+"
                table.insert(minimizedWindows, windowInfo)
            else
                window.Size = windowInfo.originalSize
                contentFrame.Visible = true
                minimizeButton.Text = "─"
                for idx, win in ipairs(minimizedWindows) do
                    if win.frame == window then
                        table.remove(minimizedWindows, idx)
                        break
                    end
                end
            end
        end)
        
        table.insert(windows, windowInfo)
    end

    -- API
    local WindUI = {}

    function WindUI.AddFunction(categoryName, functionName, callback)
        for _, windowInfo in ipairs(windows) do
            if windowInfo.categoryName == categoryName then
                local contentFrame = windowInfo.contentFrame
                if contentFrame then
                    local functionButton = Instance.new("TextButton")
                    functionButton.Name = functionName
                    functionButton.Size = UDim2.new(1, -4, 0, 26)
                    functionButton.Position = UDim2.new(0, 2, 0, 5 + (windowInfo.featuresCount * 30))
                    functionButton.BackgroundColor3 = Color3.fromRGB(40, 25, 60)
                    functionButton.Text = functionName
                    functionButton.TextColor3 = Color3.fromRGB(220, 180, 255)
                    functionButton.TextSize = 12
                    functionButton.Font = Enum.Font.Gotham
                    functionButton.AutoButtonColor = true
                    functionButton.Parent = contentFrame
                    
                    functionStates[functionName] = false
                    
                    -- 按钮交互效果
                    functionButton.MouseEnter:Connect(function()
                        if functionStates[functionName] then
                            functionButton.BackgroundColor3 = Color3.fromRGB(255, 180, 220)
                        else
                            functionButton.BackgroundColor3 = Color3.fromRGB(50, 30, 70)
                        end
                        functionButton.TextColor3 = Color3.fromRGB(240, 200, 255)
                    end)
                    
                    functionButton.MouseLeave:Connect(function()
                        if functionStates[functionName] then
                            functionButton.BackgroundColor3 = Color3.fromRGB(255, 150, 200)
                        else
                            functionButton.BackgroundColor3 = Color3.fromRGB(40, 25, 60)
                        end
                        functionButton.TextColor3 = Color3.fromRGB(220, 180, 255)
                    end)
                    
                    functionButton.MouseButton1Down:Connect(function()
                        if functionStates[functionName] then
                            functionButton.BackgroundColor3 = Color3.fromRGB(255, 120, 180)
                        else
                            functionButton.BackgroundColor3 = Color3.fromRGB(35, 20, 55)
                        end
                    end)
                    
                    functionButton.MouseButton1Up:Connect(function()
                        functionStates[functionName] = not functionStates[functionName]
                        
                        if functionStates[functionName] then
                            functionButton.BackgroundColor3 = Color3.fromRGB(255, 150, 200)
                            functionButton.TextColor3 = Color3.fromRGB(255, 240, 245)
                            print(functionName .. " 已开启")
                        else
                            functionButton.BackgroundColor3 = Color3.fromRGB(40, 25, 60)
                            functionButton.TextColor3 = Color3.fromRGB(220, 180, 255)
                            print(functionName .. " 已关闭")
                        end
                        
                        if callback then
                            callback(functionStates[functionName])
                        end
                    end)
                    
                    windowInfo.featuresCount = windowInfo.featuresCount + 1
                    local newHeight = math.max(200, 65 + (windowInfo.featuresCount * 30))
                    windowInfo.originalSize = UDim2.new(0, windowWidth, 0, newHeight)
                    window.Size = windowInfo.originalSize
                    contentFrame.CanvasSize = UDim2.new(0, 0, 0, 10 + (windowInfo.featuresCount * 30))
                    
                    print("已添加功能到 " .. categoryName .. ": " .. functionName)
                    return true
                end
            end
        end
        return false
    end

    function WindUI.AddFunctions(categoryName, functionsTable)
        local successCount = 0
        for functionName, callback in pairs(functionsTable) do
            if WindUI.AddFunction(categoryName, functionName, callback) then
                successCount = successCount + 1
            end
        end
        return successCount > 0
    end

    function WindUI.GetWindow(categoryName)
        for _, windowInfo in ipairs(windows) do
            if windowInfo.categoryName == categoryName then
                return windowInfo
            end
        end
        return nil
    end

    function WindUI.GetAllWindows() return windows end

    function WindUI.RemoveWelcomeText()
        if welcomeFrame and welcomeFrame.Parent then
            welcomeFrame:Destroy()
        end
    end

    function WindUI.ShowWelcomeText()
        if welcomeFrame then
            welcomeFrame.Visible = true
        end
    end

    function WindUI.SetWelcomeText(newText)
        if welcomeText then
            welcomeText.Text = newText
        end
    end

    function WindUI.GetFunctionState(functionName)
        return functionStates[functionName] or false
    end

    function WindUI.SetFunctionState(functionName, state)
        if functionStates[functionName] ~= nil then
            functionStates[functionName] = state
            
            for _, windowInfo in ipairs(windows) do
                local button = windowInfo.contentFrame:FindFirstChild(functionName)
                if button then
                    if state then
                        button.BackgroundColor3 = Color3.fromRGB(255, 150, 200)
                        button.TextColor3 = Color3.fromRGB(255, 240, 245)
                    else
                        button.BackgroundColor3 = Color3.fromRGB(40, 25, 60)
                        button.TextColor3 = Color3.fromRGB(220, 180, 255)
                    end
                    
                    return true
                end
            end
        end
        return false
    end

    print("WindUI 已加载")
    print("右上角: 粉白渐变闪烁欢迎文字")
    print("左侧: 可拖动、可收纳的Strength窗口")
    print("使用 WindUI.AddFunction('Strength', '功能名', 回调函数) 来添加功能")

    return WindUI
end)()
